\documentclass[$if(fontsize)$$fontsize$,$endif$$if(lang)$$babel-lang$,$endif$$if(papersize)$$papersize$paper,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}

% Font setup for full Unicode support
\usepackage{fontspec}
\setmainfont{DejaVu Sans}
\setsansfont{DejaVu Sans}
\setmonofont{DejaVu Sans Mono}

% Math and symbols
\usepackage{unicode-math}
\setmathfont{Latin Modern Math}
\usepackage{amssymb,amsmath}

% Language and encoding
\usepackage{polyglossia}
\setmainlanguage{english}

% Colors
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}

% Graphics
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Page layout
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}

% Hyperlinks
\usepackage[unicode=true,colorlinks=true,linkcolor=$if(linkcolor)$$linkcolor$$else$blue$endif$,citecolor=blue,urlcolor=blue]{hyperref}
\urlstyle{same}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[L]{\small\itshape $title$}
\fancyhead[R]{\small\thepage}
\fancyfoot[C]{}
\renewcommand{\headrulewidth}{0.4pt}

% Title formatting
\usepackage{titlesec}
\titleformat{\section}{\Large\bfseries\color{NavyBlue}}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries\color{RoyalBlue}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalsize\bfseries\color{SteelBlue}}{\thesubsubsection}{1em}{}

% Better lists
\usepackage{enumitem}
\setlist{noitemsep,topsep=5pt,parsep=0pt,partopsep=0pt}

% Code blocks with better ASCII art support
\usepackage{listings}
\lstset{
    basicstyle=\small\ttfamily,
    breaklines=true,
    frame=single,
    backgroundcolor=\color{gray!10},
    rulecolor=\color{gray!30},
    numbers=none,
    xleftmargin=10pt,
    xrightmargin=10pt,
    aboveskip=10pt,
    belowskip=10pt,
    columns=fullflexible,
    keepspaces=true,
    literate={↑}{$\uparrow$}1 {↓}{$\downarrow$}1 {→}{$\rightarrow$}1 {←}{$\leftarrow$}1
             {↗}{$\nearrow$}1 {↖}{$\nwarrow$}1 {↙}{$\swarrow$}1 {↘}{$\searrow$}1
             {•}{$\bullet$}1 {─}{---}1 {│}{$\mid$}1
}

% Blockquotes
\usepackage{framed}
\renewenvironment{quote}{%
  \def\FrameCommand{{\color{gray!30}\vrule width 3pt}\hspace{10pt}}%
  \MakeFramed{\advance\hsize-\width\FrameRestore}%
  \small\itshape\color{gray!60!black}%
}{%
  \endMakeFramed%
}

% Better tables
\usepackage{longtable,booktabs}
\usepackage{array}
\usepackage{multirow}

% ASCII art and diagrams
\usepackage{verbatim}
\usepackage{fancyvrb}

% Better handling of code blocks and verbatim
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\},fontsize=\small}

% Emoji support (fallback for symbols)
\newfontfamily\emojifont{DejaVu Sans}[Scale=MatchLowercase]

% Better page breaks
\usepackage{needspace}
\widowpenalty=10000
\clubpenalty=10000

% Prevent overfull lines
\setlength{\emergencystretch}{3em}
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Enhanced cross-references
\usepackage{nameref}
\usepackage{cleveref}

% Section numbering depth
$if(numbersections)$
\setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$else$
\setcounter{secnumdepth}{-\maxdimen}
$endif$

% Title page
\title{$title$}
\author{$for(author)$$author$$sep$ \and $endfor$}
\date{$date$}

% Metadata
\hypersetup{
    pdftitle={$title$},
    pdfauthor={$for(author)$$author$$sep$, $endfor$},
    pdfsubject={Digital Signal Processing and Wireless Communications},
    pdfkeywords={DSP, Wireless, Communications, Signal Processing},
}

\begin{document}

% Title page
\begin{titlepage}
    \centering
    \vspace*{2cm}
    
    {\Huge\bfseries\color{NavyBlue} $title$\par}
    \vspace{1cm}
    {\Large\itshape $for(author)$$author$$sep$, $endfor$\par}
    \vspace{0.5cm}
    {\large $date$\par}
    
    \vspace{2cm}
    
    {\large\itshape
    A comprehensive guide to digital signal processing,\\
    wireless communications, and emerging technologies\par}
    
    \vfill
    
    {\large Built with Chimera DSP\par}
    {\small\url{https://github.com/ArrEssJay/chimera}\par}
    
    \vspace{1cm}
\end{titlepage}

% Table of contents
$if(toc)$
{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
\clearpage
}
$endif$

% Main content
$body$

\end{document}
